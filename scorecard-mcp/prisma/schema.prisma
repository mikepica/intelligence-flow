generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model feedback_requests {
  id              Int           @id @default(autoincrement())
  skill_output_id Int
  requested_by    String
  requested_from  String
  request_message String?
  status          String        @default("pending")
  response_text   String?
  responded_at    DateTime?     @db.Timestamptz(6)
  metadata        Json?         @default("{}")
  created_at      DateTime      @default(now()) @db.Timestamptz(6)
  skill_outputs   skill_outputs @relation(fields: [skill_output_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([requested_from, status], map: "idx_feedback_requests_from_status")
  @@index([requested_by], map: "idx_feedback_requests_requested_by")
  @@index([skill_output_id], map: "idx_feedback_requests_skill_output")
  @@index([status], map: "idx_feedback_requests_status")
}

model goal_alignments {
  id                                                    Int                 @id @default(autoincrement())
  child_goal_id                                         Int
  parent_goal_id                                        Int
  alignment_type                                        alignment_type_enum @default(primary)
  alignment_strength                                    Decimal?            @default(1.00) @db.Decimal(3, 2)
  notes                                                 String?
  created_at                                            DateTime            @default(now()) @db.Timestamptz(6)
  goal_items_goal_alignments_child_goal_idTogoal_items  goal_items          @relation("goal_alignments_child_goal_idTogoal_items", fields: [child_goal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  goal_items_goal_alignments_parent_goal_idTogoal_items goal_items          @relation("goal_alignments_parent_goal_idTogoal_items", fields: [parent_goal_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([child_goal_id, parent_goal_id])
  @@index([child_goal_id], map: "idx_alignments_child")
  @@index([parent_goal_id], map: "idx_alignments_parent")
  @@index([alignment_type], map: "idx_alignments_type")
}

model goal_items {
  id                                                         Int                  @id @default(autoincrement())
  parent_id                                                  Int?
  org_unit_id                                                Int
  goal_level                                                 goal_level_enum
  name                                                       String
  description                                                String?
  owner                                                      String?
  status                                                     status_enum          @default(Active)
  weight                                                     Decimal?             @default(1.00) @db.Decimal(5, 2)
  priority                                                   Int?                 @default(0)
  start_date                                                 DateTime?            @db.Date
  end_date                                                   DateTime?            @db.Date
  tags                                                       String[]             @default([])
  metadata                                                   Json?                @default("{}")
  created_at                                                 DateTime             @default(now()) @db.Timestamptz(6)
  updated_at                                                 DateTime             @default(now()) @db.Timestamptz(6)
  goal_alignments_goal_alignments_child_goal_idTogoal_items  goal_alignments[]    @relation("goal_alignments_child_goal_idTogoal_items")
  goal_alignments_goal_alignments_parent_goal_idTogoal_items goal_alignments[]    @relation("goal_alignments_parent_goal_idTogoal_items")
  org_units                                                  org_units            @relation(fields: [org_unit_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  goal_items                                                 goal_items?          @relation("goal_itemsTogoal_items", fields: [parent_id], references: [id], onUpdate: NoAction)
  other_goal_items                                           goal_items[]         @relation("goal_itemsTogoal_items")
  program_objectives                                         program_objectives[]
  progress_updates                                           progress_updates[]

  @@index([goal_level], map: "idx_goal_items_level")
  @@index([metadata], map: "idx_goal_items_metadata", type: Gin)
  @@index([org_unit_id, goal_level], map: "idx_goal_items_org_level")
  @@index([org_unit_id], map: "idx_goal_items_org_unit")
  @@index([parent_id], map: "idx_goal_items_parent")
  @@index([status], map: "idx_goal_items_status")
  @@index([tags], map: "idx_goal_items_tags", type: Gin)
}

model org_units {
  id              Int            @id @default(autoincrement())
  parent_id       Int?
  org_level       org_level_enum
  name            String
  description     String?
  owner           String?
  status          status_enum    @default(Active)
  priority        Int?           @default(0)
  start_date      DateTime?      @db.Date
  end_date        DateTime?      @db.Date
  tags            String[]       @default([])
  metadata        Json?          @default("{}")
  created_at      DateTime       @default(now()) @db.Timestamptz(6)
  updated_at      DateTime       @default(now()) @db.Timestamptz(6)
  goal_items      goal_items[]
  org_units       org_units?     @relation("org_unitsToorg_units", fields: [parent_id], references: [id], onUpdate: NoAction)
  other_org_units org_units[]    @relation("org_unitsToorg_units")

  @@index([org_level], map: "idx_org_units_level")
  @@index([metadata], map: "idx_org_units_metadata", type: Gin)
  @@index([parent_id], map: "idx_org_units_parent")
  @@index([status], map: "idx_org_units_status")
  @@index([tags], map: "idx_org_units_tags", type: Gin)
}

model program_objectives {
  id             Int          @id @default(autoincrement())
  program_id     Int
  quarter        quarter_enum
  year           Int          @default(2026)
  objective_text String
  target_value   Decimal?     @db.Decimal(12, 2)
  target_unit    String?
  status         status_enum  @default(Active)
  metadata       Json?        @default("{}")
  created_at     DateTime     @default(now()) @db.Timestamptz(6)
  updated_at     DateTime     @default(now()) @db.Timestamptz(6)
  goal_items     goal_items   @relation(fields: [program_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([program_id, quarter, year])
  @@index([program_id], map: "idx_objectives_program")
  @@index([year, quarter], map: "idx_objectives_quarter_year")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model progress_updates {
  id               Int              @id @default(autoincrement())
  program_id       Int
  version          Int
  update_text      String
  percent_complete Decimal?         @db.Decimal(5, 2)
  rag_status       rag_status_enum?
  metrics          Json?            @default("{}")
  author           String?
  created_at       DateTime         @default(now()) @db.Timestamptz(6)
  goal_items       goal_items       @relation(fields: [program_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([program_id, version])
  @@index([created_at(sort: Desc)], map: "idx_progress_created")
  @@index([metrics], map: "idx_progress_metrics", type: Gin)
  @@index([program_id], map: "idx_progress_program")
  @@index([rag_status], map: "idx_progress_rag")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model skill_outputs {
  id                Int                 @id @default(autoincrement())
  skill_id          Int
  person_name       String
  goal_name         String
  output_data       Json
  output_summary    String?
  status            String              @default("completed")
  metadata          Json?               @default("{}")
  created_at        DateTime            @default(now()) @db.Timestamptz(6)
  feedback_requests feedback_requests[]
  skills            skills              @relation(fields: [skill_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([created_at(sort: Desc)], map: "idx_skill_outputs_created")
  @@index([goal_name], map: "idx_skill_outputs_goal_name")
  @@index([person_name], map: "idx_skill_outputs_person_name")
  @@index([skill_id], map: "idx_skill_outputs_skill")
  @@index([status], map: "idx_skill_outputs_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model skills {
  id            Int             @id @default(autoincrement())
  person_name   String
  skill_name    String
  skill_type    String
  description   String?
  input_spec    Json?           @default("{}")
  output_spec   Json?           @default("{}")
  metadata      Json?           @default("{}")
  created_at    DateTime        @default(now()) @db.Timestamptz(6)
  updated_at    DateTime        @default(now()) @db.Timestamptz(6)
  skill_outputs skill_outputs[]

  @@unique([person_name, skill_name])
  @@index([metadata], map: "idx_skills_metadata", type: Gin)
  @@index([person_name], map: "idx_skills_person_name")
  @@index([skill_type], map: "idx_skills_skill_type")
}

enum alignment_type_enum {
  primary
  secondary
  cross_cutting @map("cross-cutting")
}

enum goal_level_enum {
  Pillar
  Category
  Goal
  Program
}

enum org_level_enum {
  Enterprise
  Business_Unit  @map("Business Unit")
  Function
  Department
  Sub_Department @map("Sub-Department")
  Individual
}

enum quarter_enum {
  Q1
  Q2
  Q3
  Q4
}

enum rag_status_enum {
  Red
  Amber
  Green
  Not_Started @map("Not Started")
  Complete
}

enum status_enum {
  Active
  Inactive
  Archived
}
